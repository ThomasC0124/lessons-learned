## Instance SSH Connection
Once the instance is launched on the AWS console, the next step is to establish the SSH connection for future users.
To do so, first locate the `.pem` file generated by the AWS console. Make sure to move the `.pem` file under `~/.ssh/`
and update its access privilege to **600**:

```sh
$ mv <your-pem-file>.pem ~/.ssh/
$ chmod 600 <your-pem-file>.pem
```

Next, `ssh` to the instance with the `.pem` file:
```sh
$ ssh -i ~/.ssh/your-pem-file.pem <account>@instance-public-dns
```
`account` here depends on the type of instance/AMI that is being launched. For `ubuntu`, it is `ubuntu`.
For `amazon-linux`, it is `ec2-user`.

Next, create user account and generate the SSH key
```sh
$ sudo su -
$ adduser <username>
$ su - <username>
$ ssh-keygen -t rsa -C "your_email@example.com"
```

## Setup a Multi-Factor Auth for SSH
We adopt OATH-TOTP (Open Authentication Time-Based One-Time Password).
Please read this [tutorial](https://www.digitalocean.com/community/tutorials/how-to-protect-ssh-with-two-factor-authentication) first.

- install `libpam-google-authenticator`
```sh
$ sudo apt-get install libpam-google-authenticator
```

- edit `/etc/pam.d/sshd` as follows
```sh
# Standard Un*x authentication.
#@include common-auth
auth required pam_google_authenticator.so
```

- edit `/etc/ssh/sshd_config` as follows
```
# Change to yes to enable challenge-response passwords (beware issues with
# some PAM modules and threads)
ChallengeResponseAuthentication yes
...
## Add this line to the end of the file
AuthenticationMethods publickey,keyboard-interactive
```

- for each user, including `ubuntu`
```sh
$ google-authenticator
$ ... time based? [y/n] y
$ ... 30s restriction? [y/n] y
$ ... window 1:30min to 4min? [y/n] n
$ ... enable rate limiting? [y/n] y
$ sudo service ssh restart
```

## Install Python and Virtualenv
Please follow the steps below to install Python and SSL. It is also advised to use [`virtualenv`](https://virtualenv.pypa.io/en/latest/) to install and manage your project-specific packages.

- first of all, install all of the necessary Ubuntu packages
```sh
$ sudo apt-get update
$ sudo apt-get install make gcc libreadline-gplv2-dev libncursesw5-dev libssl-dev libsqlite3-dev tk-dev libgdbm-dev libc6-dev libbz2-dev zlib1g-dev libffi-dev
```

- check [Python's official website](https://www.python.org/downloads/source/) and download the latest release
```sh
# e.g., <latest-version> can be 3.7.4
$ wget https://www.python.org/ftp/python/<latest-version>/Python-<latest-version>.tgz
```

- extract the resource files
```sh
$ tar -xvf Python-<latest-version>.tgz
```

- change the directory to `Python-<latest-version>` and configure the settings
```sh
$ cd Python-<latest-version>
$ ./configure
```

- install Python
```sh
$ sudo make && sudo make install
```

- Python should come with `pip3`, which will be used to install `virtualenv`
```sh
$ pip3 install virtualenv
```

- create your own virtual environment
```sh
$ cd <dir-where-your-project-lives>
$ virtualenv venv
$ source venv/bin/activate
$ (venv) pip install <your-project-packages-here>
$ (venv) deactive       # to deactivate the virtual environment
```
